<!DOCTYPE html>
<html>

<head>
	<title> Staff </title>
	<link rel="stylesheet" href="../Style/CBOStyle.css">
</head>

<body>
    <script>
        function register_staff() {
            var http = new XMLHttpRequest();
            var url = '/registerstaff';
            var message = "fname=" + document.getElementById("staff_fname").value + "&lname=" + document.getElementById("staff_lname").value + "&role=" + document.getElementById("staff_role").value;

            http.open('POST', url, true);

            http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

            http.onreadystatechange = function () {
                if (http.readyState == 4) {
                    if (http.status == 200) {
                        var response = JSON.parse(http.responseText);
                        alert(response.answer);
                    }
                    else {
                        alert("Registration failure!");
                    }
                }
            };

            http.send(message);
        };

        // function change_staff() {
        //     var http = new XMLHttpRequest();
        //     var url = '/changestaff';
        //     var message = "changeid=";

        //     http.open('POST', url, true);

        //     http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

        //     http.onreadystatechange = function () {
        //         if (http.readyState == 4) {
        //             if (http.status == 200) {
        //                 var response = JSON.parse(http.responseText);
        //                 alert(response);
        //             }
        //             else {
        //                 alert("Registration failure!");
        //             }
        //         }
        //     };

        //     http.send(message);
        // };

        function refresh_staff_list() {
            var http = new XMLHttpRequest();
            var url = '/refreshstaff';

            http.open('POST', url, true);

            http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

            http.onreadystatechange = function () {
                if (http.readyState == 4) {
                    if (http.status == 200) {
                        var response = JSON.parse(http.responseText);
                        if (response.answer == "No staff!") {
                            alert("No staff!");
                        }
                        else {
                            document.getElementById("display_tbody").innerHTML = "";
                            var tbodyRef = document.getElementById("display_table").getElementsByTagName("tbody")[0];
                            for (let i = 0; i < response.answer.length; i++) {
                                var row = tbodyRef.insertRow();
                                var idcell = row.insertCell();
                                var fnameCell = row.insertCell();
                                var lnameCell = row.insertCell();
                                var roleCell = row.insertCell();
                                var dateCell = row.insertCell();
                                var editCell = row.insertCell();

                                idcell.innerHTML = response.answer[i].ID;
                                fnameCell.innerHTML = response.answer[i].firstname;
                                lnameCell.innerHTML = response.answer[i].lastname;
                                roleCell.innerHTML = response.answer[i].role;
                                dateCell.innerHTML = response.answer[i].joindate;

                                var button_onclick = response.answer[i].ID + ", '" + response.answer[i].firstname + "', '" + response.answer[i].lastname + "', '" + response.answer[i].role + "'";
                                editCell.innerHTML = '<button id="' + response.answer[i].ID + '_button" name="' + response.answer[i].ID + '_button" onclick="openEdit(' + button_onclick + ')">Edit</button>';
                            }
                        }
                    }
                }
            };
            http.send("refresh");

        };

        function openEdit(staff_ID, first_name, last_name, role) {
            document.getElementById("popup_header").innerText = "Edit Staff " + staff_ID;
            document.getElementById("first_name").placeholder = first_name;
            document.getElementById("last_name").placeholder = last_name;
            document.getElementById("role").placeholder = role;
            document.getElementById("staff_edit_popup").style.display = "block";
            document.getElementById("id").value = staff_ID;
        }

        function closeEdit() {
            document.getElementById("staff_edit_popup").style.display = "none";
        }

    </script>

	<div class=header>
		<h1> Staff </h1>
	</div>

    <div class="navBar">
	<a href="customer_page.html"> Customers </a>
	<a href="staff_page.html"> Staff </a>
	</div>
	
    <div id="staff_registation_div">
        <label>Register New Staff</label><br><br>
        <input id="staff_fname" type="text" name="staff_fname" placeholder="First Name">
        <input id="staff_lname" type="text" name="staff_lname" placeholder="Last Name">
        <input id="staff_role" type="text" name="staff_role" placeholder="Role"><br><br>
        <button onclick="register_staff()">Register</button><br><br><br><br>
    </div>
	
    <div id="staff_display_div">
        <label for="staff_display">Staff Display</label><br><br>
        <button onclick="refresh_staff_list()">Refresh Staff List</button><br><br>
        <table border="1px solid black" id="display_table">
            <thead>
                <th>Staff ID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Role</th>
                <th>Date Joined</th>
            </thead>
            <tbody id="display_tbody">
            </tbody>
        </table>
    </div>

    <div id="staff_edit_popup" class="popup">
        <form action="/editstaff" method="post">
            <h1 id="popup_header">Edit Staff </h1>
            <label for="first_name">First Name</label>
            <input id="first_name" type="text" name="first_name"> <br><br>
            <label for="last_name">Last Name</label>
            <input id="last_name" type="text" name="last_name"> <br><br>
            <label for="role">Role</label>
            <input id="role" type="text" name="role"> <br><br>
            <input type="hidden" id="id" name="id">

            <button type="submit">Submit</button>
            <button type="button" onclick="closeEdit()">Close</button>
        </form>
    </div>
</body>

</html>